/**
 * @version $Id: jquery.djmegamenu.js 51 2016-03-02 13:54:54Z szymon $
 * @package DJ-MegaMenu
 * @copyright Copyright (C) 2013 DJ-Extensions.com, All rights reserved.
 * @license DJ-Extensions.com Proprietary Use License
 * @author url: http://dj-extensions.com
 * @author email contact@dj-extensions.com
 * @developer Szymon Woronowski - szymon.woronowski@design-joomla.eu
 */
(function($){var j=function(a,b){this.options={openDelay:250,closeDelay:500,animIn:'fadeIn',animOut:'fadeOut',animSpeed:'normal',duration:450,wrap:null,direction:'ltr',event:'mouseenter',touch:(('ontouchstart'in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0)),offset:0,wcag:1};this.init(a,b)};j.prototype.init=function(c,d){var f=this;jQuery.extend(f.options,d);if(!c.length)return;f.options.menu=c;f.options.blurTimer=null;switch(f.options.animSpeed){case'fast':f.options.duration=250;break;case'slow':f.options.duration=650;break}c.addClass(f.options.animSpeed);var g=c.find('li.dj-up');f.kids=[];if(!f.options.wrap)f.options.wrap=c;else f.options.wrap=$('#'+f.options.wrap);if(f.options.touch)c.on('touchstart',function(e){e.stopPropagation()});g.each(function(a){var b=$(this);f.kids[a]=new l(b,0,f,f.options)});if(f.options.fixed==1&&!f.options.touch){$(window).one('load',f.makeSticky.bind(f,c))}if(f.options.wcag==1){f.focusable=c.find('a[href], [tabindex]');c.on('keydown',function(e){f.focusNearest(e)})}};j.prototype.focusNearest=function(c){var d=this;var e=c.which,cur=d.options.menu.find(':focus'),pos=cur.offset(),min={x:1024,y:1024},nearest=null;var f=function(a){if(a.is(':hidden')||a==cur)return;var k=a.offset();var b={x:Math.abs(k.left-pos.left),y:Math.abs(k.top-pos.top)};if((e==37&&k.left<pos.left)||(e==39&&k.left>pos.left)){if(b.y<min.y||(b.y==min.y&&b.x<min.x)){min=b;nearest=a}}else if((e==38&&k.top<pos.top)||(e==40&&k.top>pos.top)&&b.x<a.width()){if(b.x+b.y<min.x+min.y){min=b;nearest=a}}};d.focusable.each(function(){f($(this))});if(nearest){c.preventDefault();c.stopPropagation();nearest.focus()}};j.prototype.makeSticky=function(a){var b=this;b.sticky=false;var c=$('<div id="'+a.attr('id')+'sticky"></div>');c.addClass('dj-megamenu').addClass('dj-megamenu-'+b.options.theme).addClass('dj-megamenu-sticky');c.css({position:'fixed',top:parseInt(b.options.offset),left:0,width:'100%',display:'none'});c.insertAfter(a);var d=$('#'+a.attr('id')+'stickylogo');if(d.length){c.append(d);d.css('display','block')}var e=a.offset().top-parseInt(b.options.offset);var f=a.clone();f.attr('id',a.attr('id')+'placeholder');f.css({display:'none',opacity:0});f.insertBefore(a);var g=b.options.direction=='rtl'?'right':'left';$(window).scroll(b.scroll.bind(b,c,a,f,e,g,false));$(window).resize(b.scroll.bind(b,c,a,f,e,g,true))};j.prototype.scroll=function(a,b,c,d,e,f){var g=this;if($(window).scrollTop()>d){if(!g.sticky||f){var h=b.offset();var i=e=='left'?h.left:$(window).width()-h.left-b.outerWidth();b.css(e,i);b.css('max-width',$(window).width()-i);if(!f){c.css('display','');a.css('display','');a.append(b);g.sticky=true}}}else if(g.sticky){a.css('display','none');c.css('display','none');b.insertAfter(c);b.css(e,'');b.css('max-width','');g.sticky=false}};var l=function(a,b,c,d){this.options={};this.init(a,b,c,d)};l.prototype.init=function(b,c,d,f){var g=this;jQuery.extend(g.options,f);g.menu=b;g.level=c;g.parent=d;g.timer=null;g.blurTimer=null;g.sub=g.menu.find('> .dj-subwrap').first();var h='mouseenter';if(g.options.touch||g.options.event=='click_all'){h=g.options.touch?h:'click';var i=g.menu.find('> a').first();if(i.length){if(g.menu.hasClass('separator'))i.css('cursor','pointer');i.on('touchend click',function(e){if(g.sub.length&&!g.menu.hasClass('hover')){e.preventDefault();if(e.type=='touchend')g.menu.trigger('click')}})}}else if(g.options.event=='click'&&g.menu.hasClass('separator')){var i=g.menu.find('> a').first();if(i.length)i.css('cursor','pointer');h='click'}if(g.options.touch){g.menu.on('click',g.showSub.bind(g));$(document).on('touchstart',function(){if(g.menu.hasClass('hover'))g.menu.trigger('mouseleave')})}g.menu.on(h,g.showSub.bind(g));g.menu.on('mouseleave',g.hideSub.bind(g));if(g.options.wcag==1){var i=g.menu.find('> a').first();i.on('focus',g.showSub.bind(g));i.on('blur',function(){g.blurTimer=setTimeout(function(){if(!g.options.menu.find(':focus').length){var a=g;while(a.level>0){a.hideSub();a=a.parent}a.hideSub()}},1000)});i.on('keydown',function(e){g.focusNearest(e)});g.options.menu.on('click',function(){clearTimeout(g.blurTimer)})}if(g.sub.length){g.kids=[];g.initKids()}};l.prototype.focusNearest=function(c){var d=this;var e=c.which;var f=d.menu.offset(),min={x:1024,y:1024},nearest=null;var g=function(a){if(!a.menu||!a.menu.find('> a').length)return;var k=a.menu.offset();var b={x:Math.abs(k.top-f.top),y:Math.abs(k.left-f.left)};if((e==37&&k.left<f.left)||(e==39&&k.left>f.left)){if(b.x<min.x||(b.x==min.x&&b.y<min.y)){min=b;nearest=a}}else if((e==38&&k.top<f.top)||(e==40&&k.top>f.top)){if(b.y<min.y||(b.y==min.y&&b.x<min.x)){min=b;nearest=a}}};$.each(d.parent.kids,function(a,b){g(b)});if(!nearest){g(d.parent);if(d.sub.length){$.each(d.kids,function(a,b){g(b)})}}if(nearest){c.preventDefault();c.stopPropagation();nearest.menu.find('> a').first().focus()}};l.prototype.showSub=function(){var a=this;clearTimeout(a.timer);if(a.menu.hasClass('hover')&&!a.sub.hasClass(a.options.animOut)){return}if(a.sub.length){a.sub.css('display','none')}a.timer=setTimeout(function(){clearTimeout(a.animTimer);a.menu.addClass('hover');a.hideOther();if(a.sub.length){a.sub.css('display','');a.sub.removeClass(a.options.animOut);a.checkDir();a.sub.addClass(a.options.animIn)}},a.options.openDelay)};l.prototype.hideSub=function(){var a=this;clearTimeout(a.timer);if(a.sub.length){a.timer=setTimeout(function(){a.sub.removeClass(a.options.animIn);a.sub.addClass(a.options.animOut);a.animTimer=setTimeout(function(){a.menu.removeClass('hover')},a.options.duration)},a.options.closeDelay)}else{a.menu.removeClass('hover')}};l.prototype.checkDir=function(){var a=this;a.sub.css('left','');a.sub.css('right','');a.sub.css('margin-left','');a.sub.css('margin-right','');var b=a.sub.offset();var c=a.options.wrap.offset();if(a.options.direction=='ltr'){var d=b.left+a.sub.outerWidth()-a.options.wrap.outerWidth()-c.left;if(d>0||a.sub.hasClass('open-left')){if(a.level){a.sub.css('right',a.menu.outerWidth());a.sub.css('left','auto')}else{if(a.sub.hasClass('open-left')){a.sub.css('right',a.sub.css('left'));a.sub.css('left','auto')}else{a.sub.css('margin-left',-d)}}}}else if(a.options.direction=='rtl'){var d=b.left-c.left;if(d<0||a.sub.hasClass('open-right')){if(a.level){a.sub.css('left',a.menu.outerWidth());a.sub.css('right','auto')}else{if(a.sub.hasClass('open-right')){a.sub.css('left',a.sub.css('right'));a.sub.css('right','auto')}else{a.sub.css('margin-right',d)}}}}};l.prototype.initKids=function(){var c=this;var d=c.sub.find('> .dj-subwrap-in > .dj-subcol > ul.dj-submenu > li');d.each(function(a){var b=$(this);c.kids[a]=new l(b,c.level+1,c,c.options)})};l.prototype.hideOther=function(){var c=this;$.each(c.parent.kids,function(a,b){if(b.menu.hasClass('hover')&&b!=c){if(b.sub.length){b.hideOtherSub();b.sub.removeClass(b.options.animIn);b.sub.addClass(b.options.animOut);b.animTimer=setTimeout(function(){b.menu.removeClass('hover')},c.options.duration)}else{b.menu.removeClass('hover')}}})};l.prototype.hideOtherSub=function(){var c=this;$.each(c.kids,function(a,b){if(b.sub.length){b.hideOtherSub();b.sub.removeClass(b.options.animIn);b.sub.removeClass(b.options.animOut)}b.menu.removeClass('hover')})};$(document).ready(function(){$('.dj-megamenu[data-options]').each(function(){var a=$(this);a.find('.dj-hideitem').remove();a.data();var b=a.data('options');a.removeAttr('data-options');new j(a,b)})})})(jQuery);